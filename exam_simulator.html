<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCA SUSE 15 - Simulator Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0/index.min.js"></script>
    <script>MobileDragDrop.polyfill({dragImageTranslateOverride:0});</script>

    <style>
        :root { --primary: #0c322c; --secondary: #30ba78; --bg: #f8fafc; --text: #334155; --white: #ffffff; --border: #e2e8f0; --wrong: #ef4444; }
        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; }
        
        .app-container { width: 100%; max-width: 850px; background: var(--white); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); overflow: hidden; margin-bottom: 40px; border: 1px solid var(--border); }
        
        /* HEADER & PROGRESS */
        header { background: var(--primary); color: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 1.2rem; font-weight: 600; }
        .status-badge { background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; }
        .progress-bar { height: 6px; background: #cbd5e1; width: 100%; }
        .progress-fill { height: 100%; background: var(--secondary); width: 0%; transition: width 0.3s ease; }

        /* CONTENT AREAS */
        main { padding: 30px; min-height: 400px; }
        .screen { display: none; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* START & RESULT */
        .center-screen { text-align: center; padding: 40px 0; }
        .big-btn { background: var(--secondary); color: white; border: none; padding: 15px 40px; font-size: 1.2rem; font-weight: 700; border-radius: 8px; cursor: pointer; transition: transform 0.1s; box-shadow: 0 4px 0 #258e5c; }
        .big-btn:active { transform: translateY(4px); box-shadow: none; }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; border: 8px solid var(--secondary); display: flex; justify-content: center; align-items: center; font-size: 3rem; font-weight: 800; color: var(--primary); margin: 20px auto; }
        
        /* QUESTIONS */
        .q-tag { display: inline-block; background: #e0f2fe; color: #0369a1; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; margin-bottom: 15px; }
        .q-text { font-size: 1.35rem; font-weight: 600; color: #0f172a; margin-bottom: 30px; line-height: 1.4; }
        
        /* OPTIONS (SINGLE/MULTI) */
        .opt-list { display: flex; flex-direction: column; gap: 10px; }
        .opt-btn { background: white; border: 2px solid var(--border); padding: 15px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; transition: all 0.2s; font-size: 1rem; }
        .opt-btn:hover:not(.disabled) { border-color: #94a3b8; background: #f8fafc; }
        .opt-btn.selected { border-color: var(--primary); background: #f0fdf4; color: #14532d; font-weight: 500; }
        .opt-btn input { margin-right: 15px; transform: scale(1.3); accent-color: var(--primary); }
        .opt-btn.disabled { opacity: 0.7; cursor: not-allowed; }

        /* DRAG & DROP & MATCH */
        .drag-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .drag-col { flex: 1; min-width: 280px; }
        .drag-header { font-weight: 700; color: #64748b; margin-bottom: 10px; text-transform: uppercase; font-size: 0.8rem; }
        .drop-zone { 
            background: #f1f5f9; 
            border: 2px dashed #cbd5e1; 
            border-radius: 8px; 
            min-height: 250px; /* IMPORTANTE: Esto le da altura para que puedas soltar */
            padding: 15px; 
            transition: background 0.2s;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .drop-zone.drag-over { background: #dcfce7; border-color: var(--secondary); }
        .drag-item { background: white; padding: 12px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #cbd5e1; border-left: 4px solid var(--secondary); cursor: grab; font-weight: 500; box-shadow: 0 1px 2px rgba(0,0,0,0.05); user-select: none; }
        .drag-item:active { cursor: grabbing; }

        /* MATCH SPECIFIC */
        .match-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; align-items: center; }
        .match-static { background: #e2e8f0; padding: 12px; border-radius: 6px; font-weight: 600; font-size: 0.9rem; }
        .match-drop { min-height: 48px; padding: 4px; border: 2px dashed #cbd5e1; border-radius: 6px; background: white; }
        
        /* INPUT FILL */
        .input-fill { width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid var(--border); border-radius: 8px; font-family: 'Consolas', monospace; }
        .input-fill:focus { border-color: var(--secondary); }

        /* FOOTER & FEEDBACK */
        .feedback { margin-top: 25px; padding: 20px; border-radius: 8px; display: none; animation: fadeIn 0.3s; }
        .feedback.correct { background: #dcfce7; border: 1px solid #bbf7d0; color: #14532d; }
        .feedback.wrong { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; }
        
        footer { border-top: 1px solid var(--border); padding: 20px 30px; display: flex; justify-content: space-between; background: #fcfcfc; }
        .nav-btn { padding: 10px 24px; border-radius: 6px; font-weight: 600; cursor: pointer; border: 1px solid transparent; }
        .btn-sec { color: #64748b; background: transparent; }
        .btn-sec:hover { background: #f1f5f9; }
        .btn-pri { background: var(--primary); color: white; }
        .btn-pri:disabled { opacity: 0.5; cursor: not-allowed; }

        @media (max-width: 600px) {
            .drag-container { flex-direction: column; }
            .match-row { grid-template-columns: 1fr; }
        }
        /* HOTSPOT / IMAGEN */
        .hotspot-container { position: relative; display: inline-block; max-width: 100%; overflow: hidden; border-radius: 8px; border: 2px solid var(--border); cursor: crosshair; }
        .hotspot-img { display: block; width: 100%; height: auto; user-select: none; }
        .hotspot-pin { 
            position: absolute; width: 30px; height: 30px; 
            background: var(--secondary); border: 2px solid white; 
            border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transform: translate(-50%, -50%); /* Para centrar el pin en el click */
            pointer-events: none; transition: top 0.2s, left 0.2s;
            display: none; /* Oculto hasta que se hace click */
            justify-content: center; align-items: center; font-size: 1.2rem;
        }
        .hotspot-pin.active { display: flex; }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>SUSE SCA 15 Simulator</h1>
        <div class="status-badge"><span id="curr-q">0</span> / <span id="total-q">0</span></div>
    </header>
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <main>
        <div id="start-screen" class="screen active center-screen">
            <h2 style="margin-bottom: 10px;">Exam Simulation</h2>
            <p style="color: #64748b; margin-bottom: 40px;">Mixed questions: Single & Multiple Choice, Drag & Drop, Fill in the blanks and Hotspot.</p>
            <button class="big-btn" onclick="quiz.start()">START EXAM</button>
        </div>

        <div id="quiz-screen" class="screen">
            <div class="q-tag" id="q-type">TYPE</div>
            <div class="q-text" id="q-text">Loading...</div>

            <div id="render-area"></div>

            <div id="feedback" class="feedback"></div>
        </div>

        <div id="result-screen" class="screen center-screen">
            <h2>Exam Completed</h2>
            <div class="score-circle" id="final-score">0%</div>
            <p id="final-msg" style="font-size: 1.1rem; color: #64748b; margin-bottom: 30px;"></p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="nav-btn btn-sec" onclick="location.reload()">Exit</button>
                <button class="big-btn" onclick="location.reload()">Retake</button>
            </div>
        </div>
    </main>

    <footer id="footer" style="display:none;">
        <button class="nav-btn btn-sec" id="btn-prev" onclick="quiz.prev()" disabled>Previous</button>
        <div>
            <button class="nav-btn btn-pri" id="btn-check" onclick="quiz.check()">Submit Answer</button>
            <button class="nav-btn btn-pri" id="btn-next" onclick="quiz.next()" style="display:none;">Next Question</button>
        </div>
    </footer>
</div>

<script>
// =============================================================================
//  DATA SOURCE - SCA SLES 15 (2025 Update) - COMPLETO
// =============================================================================
const DATA = [

    // -------------------------------------------------------------------------
    // 02 Overview of SUSE Linux Enterprise
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "The openSUSE Leap version of Linux is designed for which types of user environments? (Select 2)", 
        options: [
            {text: "Environments requiring High-Availability", correct: false},
            {text: "Desktop power users", correct: true},
            {text: "Users requiring only secure terminal access", correct: false},
            {text: "Data Center environments", correct: false},
            {text: "Developers", correct: true}
        ], 
        rationale: "openSUSE Leap is a community distribution built from SLES sources, targeted at Developers and Power Users, whereas SLES is for Data Centers and Enterprise workloads." 
    },
    { 
        type: "SINGLE", 
        text: "What is the standard General Support duration for a major version of SUSE Linux Enterprise Server (excluding LTSS)?", 
        options: [
            {text: "5 Years", correct: false},
            {text: "10 Years", correct: true},
            {text: "13 Years", correct: false},
            {text: "18 Months", correct: false}
        ], 
        rationale: "SLES offers 10 years of General Support plus 3 years of optional Long Term Service Pack Support (LTSS), totaling 13 years.<br><br><a href='https://www.suse.com/lifecycle/' target='_blank'>üìö SUSE Lifecycle</a>" 
    },
    { 
        type: "MULTI", 
        text: "Which statements regarding 'Technology Previews' in SLES 15 are true? (Select 2)", 
        options: [
            {text: "They are fully supported by L3 support.", correct: false},
            {text: "They are suitable for production environments.", correct: false},
            {text: "They are not supported and may be removed at any time.", correct: true},
            {text: "They are included to provide a glimpse into upcoming innovations.", correct: true}
        ], 
        rationale: "Technology Previews are for testing only, are not supported, and SUSE does not guarantee they will become supported features.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-adm-support.html#sec-support-tech-previews' target='_blank'>üìö SUSE Docs: Technology Previews</a>" 
    },
    { 
        type: "MATCHING", 
        text: "Match the SUSE Support Levels to their definitions.", 
        pairs: [
            {term: "Level 1 (L1)", def: "Problem determination and usage support"},
            {term: "Level 2 (L2)", def: "Problem isolation and reproduction"},
            {term: "Level 3 (L3)", def: "Problem resolution and code fixes"}
        ], 
        rationale: "L1 gathers info, L2 reproduces the issue, and L3 involves engineering to fix the code.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-adm-support.html' target='_blank'>üìö SUSE Docs: Support Levels</a>" 
    },
    { 
        type: "FILL", 
        text: "What command line tool is used to register a SLES system with the SUSE Customer Center (SCC)?", 
        validAnswers: ["SUSEConnect"], 
        rationale: "The command is 'SUSEConnect'. It replaced the old 'suse_register'." 
    },
    { 
        type: "SINGLE", 
        text: "Where are the release notes installed locally on a SLES system?", 
        options: [
            {text: "/etc/release-notes", correct: false},
            {text: "/var/log/release-notes", correct: false},
            {text: "/usr/share/doc/release-notes", correct: true},
            {text: "/opt/suse/release-notes", correct: false}
        ], 
        rationale: "Documentation and release notes reside in /usr/share/doc.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-adm-help.html' target='_blank'>üìö SUSE Docs: Documentation Directory</a>" 
    },
    { 
        type: "SINGLE", 
        text: "Which directory contains the essential shared libraries needed to boot the system (similar to DLLs in Windows)?", 
        options: [
            {text: "/usr/lib", correct: false},
            {text: "/lib", correct: true},
            {text: "/var/lib", correct: false},
            {text: "/boot/lib", correct: false}
        ], 
        rationale: "/lib contains essential libraries for booting and the root filesystem commands. /usr/lib contains libraries for user-space applications.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-adm-fhs.html' target='_blank'>üìö SUSE Docs: FHS</a>" 
    },
    { 
        type: "MULTI", 
        text: "Which of the following are valid ways to start the YaST tool? (Select 2)", 
        options: [
            {text: "yast (Text/Ncurses mode)", correct: true},
            {text: "yast2 (Graphical mode)", correct: true},
            {text: "start_yast", correct: false},
            {text: "systemctl start yast", correct: false}
        ], 
        rationale: "'yast' typically launches the text interface (ncurses), while 'yast2' tries to launch the graphical interface (Qt/GTK)." 
    },
    { 
        type: "SINGLE", 
        text: "If you need to search for known solutions, error codes, or technical articles, which online resource should you use?", 
        options: [
            {text: "SUSE Bugzilla", correct: false},
            {text: "SUSE Knowledgebase (TIDs)", correct: true},
            {text: "GitHub", correct: false},
            {text: "StackOverflow", correct: false}
        ], 
        rationale: "The SUSE Knowledgebase contains Technical Information Documents (TIDs) for known issues.<br><br><a href='https://www.suse.com/support/kb/' target='_blank'>üìö SUSE Knowledgebase</a>" 
    },
    { 
        type: "SINGLE", 
        text: "What happens if your SLES subscription expires?", 
        options: [
            {text: "The system shuts down immediately.", correct: false},
            {text: "The system continues to run, but access to update repositories is denied.", correct: true},
            {text: "Only the root user can log in.", correct: false},
            {text: "The system automatically reverts to a community version.", correct: false}
        ], 
        rationale: "You lose access to the update channels (patches and security updates), but the OS keeps running." 
    },
    { 
        type: "FILL", 
        text: "What is the name of the system file that maps IP addresses to hostnames locally (before DNS)?", 
        validAnswers: ["/etc/hosts"], 
        rationale: "/etc/hosts is the local lookup table for hostnames." 
    },
    { 
        type: "SINGLE", 
        text: "You want to use the High Availability (HA) or Live Patching repositories. What is required?", 
        options: [
            {text: "Nothing, they are included in the base system.", correct: false},
            {text: "Just an internet connection.", correct: false},
            {text: "A separate License/Registration code for that extension.", correct: true},
            {text: "Root privileges only.", correct: false}
        ], 
        rationale: "Extensions like HA are add-on products that require a specific registration code to enable their repositories." 
    },
    { 
        type: "SINGLE", 
        text: "What command allows you to configure the network settings Graphically?", 
        options: [
            {text: "yast", correct: false},
            {text: "yast2", correct: true},
            {text: "ip addr", correct: false},
            {text: "wicked-gui", correct: false}
        ], 
        rationale: "'yast2' invokes the Qt/GTK graphical interface. 'yast' is for text mode (ncurses)." 
    },
    { 
        type: "MULTI", 
        text: "Select 3 valid SUSE Linux Enterprise 15 Products/Extensions.", 
        options: [
            {text: "SLES (General Purpose)", correct: true},
            {text: "SLE HPC (High Performance Computing)", correct: true},
            {text: "SLE Real Time", correct: true},
            {text: "SLE Macro", correct: false},
            {text: "SUSE Cloud", correct: false},
            {text: "SLE Home", correct: false}
        ], 
        rationale: "The SLE family includes SLES (Server), SLE HPC, SLE Real Time, and SLES for SAP. 'SLE Home' or 'Macro' do not exist as products.<br><br><a href='https://www.suse.com/products/' target='_blank'>üìö SUSE Product Portfolio</a>" 
    },

    // -------------------------------------------------------------------------
    // 03 The Command Line
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "Which bash commands result in a valid arithmetic expansion? (Choose three)", 
        options: [
            {text: "TOTAL=$((5.3+2.2))", correct: false}, // Falso: Bash no soporta decimales
            {text: "TOTAL=$[8/2]", correct: true},        // Verdadero: Sintaxis antigua pero v√°lida para enteros
            {text: "TOTAL=$[8.4/2.1]", correct: false},   // Falso: Decimales
            {text: "TOTAL=$[2.1*4]", correct: false},     // Falso: Decimales
            {text: "TOTAL=$((5+2))", correct: true},      // Verdadero: Sintaxis est√°ndar POSIX
            {text: "((TOTAL++))", correct: true}          // Verdadero: Estilo C para incrementar
        ], 
        rationale: "Bash arithmetic expansion only supports integers. Operations with decimals (floats) like 5.3 or 2.1 will fail. Valid syntaxes include $((...)), $[...] (legacy), and ((...)).<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-adm-shell.html#sec-adm-shell-expansion' target='_blank'>üìö SUSE Docs: Shell Expansion</a>" 
    },
    { 
        type: "SINGLE", 
        text: "Which command will display the value of the environment variable named TMPDIR?", 
        options: [
            {text: "val $TMPDIR", correct: false},
            {text: "echo $TMPDIR", correct: true},
            {text: "echo TMPDIR", correct: false},
            {text: "show $TMPDIR", correct: false}
        ], 
        rationale: "To view the content of a variable in Bash, use 'echo' with the '$' prefix before the variable name.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-adm-shell.html#sec-adm-shell-vars' target='_blank'>üìö SUSE Docs: Variables</a>" 
    },
    { 
        type: "MATCHING", 
        text: "Match the File Descriptors (Streams) to their ID numbers.", 
        pairs: [
            {term: "STDIN (Input)", def: "0"},
            {term: "STDOUT (Output)", def: "1"},
            {term: "STDERR (Error)", def: "2"}
        ], 
        rationale: "0 is Input, 1 is Output, 2 is Error." 
    },
    { 
        type: "MATCHING", 
        text: "Match the command operators to their logic.", 
        pairs: [
            {term: "||", def: "Run if previous failed"},
            {term: "&&", def: "Run if previous succeeded"},
            {term: ";", def: "Run always (sequential)"},
            {term: "|", def: "Pass output to input"}
        ], 
        rationale: "|| is OR (on failure), && is AND (on success), ; is separator, | is pipe." 
    },
    { 
        type: "SINGLE", 
        text: "Which key is used to autocomplete commands or file paths in the shell?", 
        options: [
            {text: "Enter", correct: false},
            {text: "Tab", correct: true},
            {text: "Space", correct: false},
            {text: "Ctrl+C", correct: false}
        ], 
        rationale: "The Tab key provides auto-completion in Bash." 
    },
    { 
        type: "MULTI", 
        text: "Select two true statements regarding Command History.", 
        options: [
            {text: "The default history size (HISTSIZE) is usually 1000.", correct: true},
            {text: "History is stored in /var/log/history.", correct: false},
            {text: "The file used is ~/.bash_history.", correct: true},
            {text: "History is cleared automatically every reboot.", correct: false}
        ], 
        rationale: "Defaults are HISTSIZE=1000 and the file is ~/.bash_history." 
    },
    { 
        type: "SINGLE", 
        text: "Where should a user define persistent aliases and variables for their shell session?", 
        options: [
            {text: "/etc/profile", correct: false},
            {text: "~/.bashrc", correct: true},
            {text: "/tmp/.profile", correct: false},
            {text: "/var/bashrc", correct: false}
        ], 
        rationale: "~/.bashrc is the standard location for user-specific shell configuration." 
    },
    { 
        type: "SINGLE", 
        text: "Where are the main manual pages (man pages) located in the filesystem?", 
        options: [
            {text: "/etc/man", correct: false},
            {text: "/usr/share/man", correct: true},
            {text: "/var/man", correct: false},
            {text: "/opt/man", correct: false}
        ], 
        rationale: "The standard path is /usr/share/man." 
    },
    { 
        type: "MATCHING", 
        text: "Match the file management commands.", 
        pairs: [
            {term: "rmdir", def: "Removes empty directories"},
            {term: "rm -r", def: "Removes directories with content"},
            {term: "mv", def: "Moves or Renames"},
            {term: "cp -r", def: "Copies directories"}
        ], 
        rationale: "rmdir only works on empty folders. mv is used for renaming." 
    },

    // -------------------------------------------------------------------------
    // 04 The Linux Filesystem
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "Select the valid device types in Linux. (Choose two)", 
        options: [
            {text: "Pipe", correct: false},
            {text: "null", correct: false}, // 'null' es un dispositivo espec√≠fico, no un TIPO
            {text: "Redirect", correct: false},
            {text: "udev", correct: false},
            {text: "Network", correct: false},
            {text: "Character", correct: true}, // Dispositivos de caracteres (teclado, rat√≥n, puertos serie)
            {text: "Block", correct: true}      // Dispositivos de bloques (discos duros, USB)
        ], 
        rationale: "In Linux, the main device types handled by the kernel are **Block** devices (storage, buffered) and **Character** devices (streams, unbuffered).<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-filesystems.html' target='_blank'>üìö SUSE Docs: Device Types</a>" 
    },
    { 
        type: "MULTI", 
        text: "Which type of files are used for inter-process communications (IPC)? (Choose two)", 
        options: [
            {text: "Socket", correct: true},
            {text: "Character", correct: false},
            {text: "Redirect", correct: false},
            {text: "Array", correct: false},
            {text: "Block", correct: false},
            {text: "Pipe", correct: true}
        ], 
        rationale: "Sockets (s) and Named Pipes (p) are special file types used for communication between processes on the same system." 
    },
    { 
        type: "MULTI", 
        text: "Select the true statements regarding Hard Links vs Symbolic Links (Select 3).", 
        options: [
            {text: "Symbolic links can cross filesystem boundaries.", correct: true},
            {text: "Hard links share the same Inode number.", correct: true},
            {text: "Hard links can point to directories.", correct: false},
            {text: "Symbolic links can point to directories.", correct: true},
            {text: "If you delete the original file, the Hard Link breaks.", correct: false}
        ], 
        rationale: "Hard links are the same file (inode). Soft links are pointers and can cross partitions." 
    },
    { 
        type: "SINGLE", 
        text: "What is VFS (Virtual File System)?", 
        options: [
            {text: "A translation tool for Windows files.", correct: false},
            {text: "A kernel abstraction layer providing a common interface for all filesystems.", correct: true},
            {text: "A specific filesystem type for virtual machines.", correct: false}
        ], 
        rationale: "VFS allows the kernel to treat all filesystems (Ext4, XFS, Btrfs) uniformly." 
    },
    { 
        type: "SINGLE", 
        text: "What are the default filesystems for Root (/) and Home (/home) in SLES 15?", 
        options: [
            {text: "Root: Ext4, Home: XFS", correct: false},
            {text: "Root: Btrfs, Home: XFS", correct: true},
            {text: "Root: XFS, Home: Btrfs", correct: false},
            {text: "Root: LVM, Home: Ext4", correct: false}
        ], 
        rationale: "Btrfs is used for / to enable Snapper rollbacks. XFS is used for /home for performance." 
    },
    // --- HOTSPOT MOUNT (Colocado en Topic 04) ---
    { 
        type: "HOTSPOT", 
        text: "In the mount command output, click on the Mount Options to check if the filesystem is Read-Only (ro) or Read-Write (rw).", 
        image: "assets/img/mount_output.png", 
        target: {x: 85, y: 50}, 
        rationale: "Mount options (rw, ro, nosuid) are displayed inside parentheses at the end of the line.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-filesystems.html' target='_blank'>üìö SUSE Docs: Mounting</a>" 
    },
    { 
        type: "HOTSPOT", 
        text: "Click on the directory where configuration files are stored (/etc).", 
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Standard-unix-filesystem-hierarchy.svg/800px-Standard-unix-filesystem-hierarchy.svg.png", 
        target: {x: 35, y: 35}, 
        rationale: "/etc contains configuration files." 
    },

    // -------------------------------------------------------------------------
    // 05 Text Editors (Vim)
    // -------------------------------------------------------------------------
    { 
        type: "FILL", 
        text: "In Vim, what command is used to quit without saving (force quit)?", 
        validAnswers: [":q!", "q!"], 
        rationale: ":q! forces exit discarding changes." 
    },
    { 
        type: "FILL", 
        text: "In Vim, what command opens a new empty window horizontally?", 
        validAnswers: [":new", "new"], 
        rationale: ":new opens a new window. :split splits the current one." 
    },
    { 
        type: "SINGLE", 
        text: "Which of the following represents the two main modes in Vim (often used in exams)?", 
        options: [
            {text: "Insert and Command (or Normal)", correct: true},
            {text: "Input and Output", correct: false},
            {text: "Write and Read", correct: false}
        ], 
        rationale: "Exams often categorize modes into Insert (typing) and Command/Normal (actions)." 
    },
    { 
        type: "MATCHING", 
        text: "Match the Vim movement keys.", 
        pairs: [
            {term: "h", def: "Left"},
            {term: "j", def: "Down"},
            {term: "k", def: "Up"},
            {term: "l", def: "Right"}
        ], 
        rationale: "h(left), j(down), k(up), l(right) allows movement without leaving the home row." 
    },
    // -------------------------------------------------------------------------
    // 05 Text Editors (Vim Focus) - 22 QUESTIONS
    // -------------------------------------------------------------------------
    
    // --- MODES & BASICS ---
    { 
        type: "SINGLE", 
        text: "Which key allows you to enter 'Insert Mode' before the cursor position?", 
        options: [
            {text: "a", correct: false},
            {text: "i", correct: true},
            {text: "o", correct: false},
            {text: "r", correct: false}
        ], 
        rationale: "'i' inserts before the cursor, 'a' appends after the cursor.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-vim.html' target='_blank'>üìö SUSE Docs: Vim Modes</a>" 
    },
    { 
        type: "SINGLE", 
        text: "How do you switch from Insert Mode back to Command (Normal) Mode?", 
        options: [
            {text: "Ctrl+C", correct: false},
            {text: "Enter", correct: false},
            {text: "Esc", correct: true},
            {text: ":q", correct: false}
        ], 
        rationale: "The 'Esc' key is the standard way to return to Normal Mode." 
    },
    { 
        type: "MATCHING", 
        text: "Match the command to enter Insert Mode.", 
        pairs: [
            {term: "i", def: "Insert before cursor"},
            {term: "a", def: "Append after cursor"},
            {term: "o", def: "Open new line below"},
            {term: "O", def: "Open new line above"}
        ], 
        rationale: "i(nsert), a(ppend), o(pen line) are the primary ways to start typing." 
    },

    // --- NAVIGATION ---
    { 
        type: "SINGLE", 
        text: "In Command Mode, which key moves the cursor to the very end of the file?", 
        options: [
            {text: "gg", correct: false},
            {text: "G", correct: true},
            {text: "$", correct: false},
            {text: "L", correct: false}
        ], 
        rationale: "'G' goes to the last line. 'gg' goes to the first line." 
    },
    { 
        type: "SINGLE", 
        text: "Which key moves the cursor to the end of the current line?", 
        options: [
            {text: "0", correct: false},
            {text: "$", correct: true},
            {text: "e", correct: false},
            {text: "A", correct: false}
        ], 
        rationale: "'$' moves to the end of the line. '0' moves to the beginning." 
    },
    { 
        type: "FILL", 
        text: "Enter the command (key) used to move the cursor to the top (first line) of the file.", 
        validAnswers: ["gg", "1G"], 
        rationale: "'gg' immediately jumps to the top of the file." 
    },
    { 
        type: "MATCHING", 
        text: "Match the navigation keys.", 
        pairs: [
            {term: "h", def: "Left"},
            {term: "j", def: "Down"},
            {term: "k", def: "Up"},
            {term: "l", def: "Right"}
        ], 
        rationale: "Standard Vi navigation keys." 
    },

    // --- EDITING (COPY / PASTE / DELETE) ---
    { 
        type: "SINGLE", 
        text: "Which command deletes the character directly under the cursor?", 
        options: [
            {text: "x", correct: true},
            {text: "d", correct: false},
            {text: "r", correct: false},
            {text: "del", correct: false}
        ], 
        rationale: "'x' deletes the character under the cursor (like Del key)." 
    },
    { 
        type: "SINGLE", 
        text: "How do you copy (yank) the current line?", 
        options: [
            {text: "cc", correct: false},
            {text: "yy", correct: true},
            {text: "dd", correct: false},
            {text: "cp", correct: false}
        ], 
        rationale: "'yy' (yank yank) copies the current line into the buffer." 
    },
    { 
        type: "SINGLE", 
        text: "How do you paste the content of the buffer after the cursor?", 
        options: [
            {text: "p", correct: true},
            {text: "P", correct: false},
            {text: "v", correct: false},
            {text: "ins", correct: false}
        ], 
        rationale: "'p' pastes after the cursor/line. 'P' pastes before." 
    },
    { 
        type: "FILL", 
        text: "Enter the command to delete the current line.", 
        validAnswers: ["dd"], 
        rationale: "'dd' deletes (cuts) the entire current line." 
    },
    { 
        type: "SINGLE", 
        text: "Which command undoes the last change?", 
        options: [
            {text: "Ctrl+z", correct: false},
            {text: "u", correct: true},
            {text: "U", correct: false},
            {text: ":undo", correct: false}
        ], 
        rationale: "'u' allows you to undo the last action." 
    },
    { 
        type: "SINGLE", 
        text: "How do you 'Redo' a change that was undone?", 
        options: [
            {text: "Ctrl+r", correct: true},
            {text: "r", correct: false},
            {text: "R", correct: false},
            {text: "Ctrl+u", correct: false}
        ], 
        rationale: "'Ctrl+r' is the standard Redo command in Vim." 
    },

    // --- SEARCH & REPLACE ---
    { 
        type: "SINGLE", 
        text: "Which character is used to start a forward search?", 
        options: [
            {text: "?", correct: false},
            {text: "/", correct: true},
            {text: ":", correct: false},
            {text: "s", correct: false}
        ], 
        rationale: "Typing '/' followed by text searches forward. '?' searches backward." 
    },
    { 
        type: "SINGLE", 
        text: "After searching with '/', which key moves to the Next occurrence?", 
        options: [
            {text: "n", correct: true},
            {text: "N", correct: false},
            {text: "Enter", correct: false},
            {text: "Space", correct: false}
        ], 
        rationale: "'n' goes to next, 'N' goes to previous." 
    },
    { 
        type: "FILL", 
        text: "Enter the command to replace ALL occurrences of 'old' with 'new' in the entire file.", 
        validAnswers: [":%s/old/new/g", ":%s/old/new/g"], 
        rationale: ":%s/old/new/g (The % selects all lines, g means global per line)." 
    },
    { 
        type: "MULTI", 
        text: "Which of the following commands will Save and Quit? (Select 2)", 
        options: [
            {text: ":wq", correct: true},
            {text: ":w", correct: false},
            {text: ":x", correct: true},
            {text: ":q!", correct: false}
        ], 
        rationale: ":wq (write quit) and :x (exit) both save changes and close the editor." 
    },
    { 
        type: "FILL", 
        text: "Enter the command to quit Vim WITHOUT saving changes (discarding them).", 
        validAnswers: [":q!", "q!"], 
        rationale: ":q! forces quit." 
    },
    { 
        type: "SINGLE", 
        text: "You want to save the file but keep it open. Which command do you use?", 
        options: [
            {text: ":w", correct: true},
            {text: ":s", correct: false},
            {text: ":wq", correct: false},
            {text: "ZZ", correct: false}
        ], 
        rationale: ":w (write) saves the buffer to disk without exiting." 
    },

    // --- ADVANCED / BUFFERS ---
    { 
        type: "SINGLE", 
        text: "Is it possible to open more than one file in Vim without running a second instance?", 
        options: [
            {text: "True", correct: true},
            {text: "False", correct: false}
        ], 
        rationale: "Yes, using :e filename, :split, :vsplit or opening with 'vim file1 file2'." 
    },
    { 
        type: "SINGLE", 
        text: "Which command splits the window vertically?", 
        options: [
            {text: ":split", correct: false},
            {text: ":vsplit", correct: true},
            {text: ":hsplit", correct: false},
            {text: ":vert", correct: false}
        ], 
        rationale: ":vsplit creates a vertical split. :split creates a horizontal one." 
    },
    { 
        type: "SINGLE", 
        text: "How do you enter Visual Block Mode (column selection)?", 
        options: [
            {text: "v", correct: false},
            {text: "V", correct: false},
            {text: "Ctrl+v", correct: true},
            {text: "Shift+v", correct: false}
        ], 
        rationale: "'v' is character visual, 'V' is line visual, 'Ctrl+v' is block visual." 
    }

    // -------------------------------------------------------------------------
    // 06 Users and Groups
    // -------------------------------------------------------------------------
    { 
        type: "HOTSPOT", 
        text: "Identify where the added secondary group for a user is displayed in the 'id' command output.", 
        // --- AQU√ç VA TU IMAGEN DEL COMANDO ID ---
        image: "assets/img/id_command_output.png", 
        target: {x: 90, y: 50}, 
        rationale: "Secondary groups appear at the very end of the 'id' command output.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-adm-users.html' target='_blank'>üìö SUSE Docs: User Identity</a>" 
    },
    
    // -------------------------------------------------------------------------
    // 07 Standard Permissions
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "Assuming default umask 022, select the default permissions for Files and Directories.", 
        options: [
            {text: "Directory: 755", correct: true},
            {text: "File: 644", correct: true},
            {text: "Directory: 777", correct: false},
            {text: "File: 755", correct: false}
        ], 
        rationale: "Dir: 777-022=755. File: 666-022=644." 
    },
    { 
        type: "MATCHING", 
        text: "Match the permission symbols.", 
        pairs: [
            {term: "rwx", def: "Read, Write, Execute"},
            {term: "rw-", def: "Read, Write"},
            {term: "r-x", def: "Read, Execute"},
            {term: "---", def: "No permissions"}
        ], 
        rationale: "Basic Linux permissions notation." 
    },

    // -------------------------------------------------------------------------
    // 08 Process Management
    // -------------------------------------------------------------------------
    { 
        type: "SINGLE", 
        text: "Which process has a higher priority (more CPU time)? Nice -15 or Nice 7?", 
        options: [
            {text: "-15", correct: true},
            {text: "7", correct: false}
        ], 
        rationale: "Lower numbers = Higher priority. -20 is max, 19 is min." 
    },
    { 
        type: "MULTI", 
        text: "Which commands can display CPU and Memory usage per process? (Select 2)", 
        options: [
            {text: "top", correct: true},
            {text: "ps aux", correct: true},
            {text: "free", correct: false},
            {text: "uptime", correct: false}
        ], 
        rationale: "top is real-time, ps aux gives a detailed snapshot including %CPU and %MEM." 
    },
    { 
        type: "FILL", 
        text: "What command is used to find the PID of a process by its name?", 
        validAnswers: ["pidof", "pgrep"], 
        rationale: "pidof or pgrep are the correct tools. 'pid' is not a command." 
    },

    // -------------------------------------------------------------------------
    // 09 System Service Management
    // -------------------------------------------------------------------------
    { 
        type: "SINGLE", 
        text: "How do you safely modify a systemd service configuration without editing the vendor file in /usr/lib?", 
        options: [
            {text: "Use 'systemctl edit service_name'", correct: true},
            {text: "Edit /usr/lib/systemd/system/file directly", correct: false},
            {text: "Use 'systemctl modify'", correct: false}
        ], 
        rationale: "systemctl edit creates a drop-in file in /etc/systemd/system/....d/ to override settings safely." 
    },

    // -------------------------------------------------------------------------
    // 10 Task Scheduling
    // -------------------------------------------------------------------------
    { 
        type: "FILL", 
        text: "Enter the crontab line to run a script at 10:35, on the 28th of every month, AND every Friday.", 
        validAnswers: ["35 10 28 * 5"], 
        rationale: "Min(35) Hour(10) Dom(28) Month(*) Dow(5). Note: Day of Month and Day of Week is an OR (Union) condition." 
    },
    { 
        type: "SINGLE", 
        text: "How often is a script in /etc/cron.weekly executed?", 
        options: [
            {text: "Once a day", correct: false},
            {text: "Once a week", correct: true},
            {text: "Once a month", correct: false}
        ], 
        rationale: "As the name suggests, it runs once every 7 days." 
    },
    { 
        type: "FILL", 
        text: "Command to edit the current user's crontab?", 
        validAnswers: ["crontab -e"], 
        rationale: "crontab -e opens the editor defined in $EDITOR." 
    },

    // -------------------------------------------------------------------------
    // 11 Privilege Delegation
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "Which commands allow you to switch your primary group or execute a command with a different group ID? (Select 2)", 
        options: [
            {text: "sg", correct: true},
            {text: "newgrp", correct: true},
            {text: "su", correct: false},
            {text: "chgrp", correct: false}
        ], 
        rationale: "newgrp changes the primary group for the session. sg executes a command as a different group." 
    },

    // -------------------------------------------------------------------------
    // 12 Remote Administration
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "Which of the following are considered native remote administration utilities in SLES? (Select 2)", 
        options: [
            {text: "ssh", correct: true},
            {text: "vnc", correct: true},
            {text: "putty", correct: false},
            {text: "ftp", correct: false}
        ], 
        rationale: "SSH (CLI) and VNC (Graphical) are the standard supported tools. Putty is a 3rd party Windows client." 
    },
    { 
        type: "SINGLE", 
        text: "Regarding VNC security in SLES 15, which statement is true about default connections?", 
        options: [
            {text: "VNC is based on Telnet so encryption is impossible.", correct: false},
            {text: "The VNC Client checks for a TLS encrypted connection by default.", correct: true},
            {text: "It uses a self-signed SSL certificate automatically trusted by all clients.", correct: false},
            {text: "The server prompts for a password configured during installation only.", correct: false}
        ], 
        rationale: "SLES 15 supports TLS encryption for VNC. If a connection is not encrypted, the client usually displays a warning '(Connection not encrypted!)'.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-remote-admin.html#sec-vnc-secure' target='_blank'>üìö SUSE Docs: VNC Security</a>" 
    },

    // -------------------------------------------------------------------------
    // 13 Storage Management Fundamentals
    // -------------------------------------------------------------------------
    { 
        type: "ORDER", 
        text: "Construct the parted command to create a primary XFS partition using the whole disk.", 
        items: ["mkpart", "primary", "xfs", "0%", "100%"], 
        correct: ["mkpart", "primary", "xfs", "0%", "100%"], 
        rationale: "Syntax: mkpart [type] [fs-type] [start] [end]." 
    },

    // -------------------------------------------------------------------------
    // 14 Logical Volume Management
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "Select the commands used to display information about Physical Volumes. (Select 3)", 
        options: [
            {text: "pvs", correct: true},
            {text: "pvdisplay", correct: true},
            {text: "pvscan", correct: true},
            {text: "pvshow", correct: false},
            {text: "fdisk", correct: false}
        ], 
        rationale: "pvs (summary), pvdisplay (verbose), and pvscan (scan & list) are the correct tools." 
    },
    { 
        type: "ORDER", 
        text: "Order the steps to create a usable LVM mount.", 
        items: ["pvcreate", "vgcreate", "lvcreate", "mkfs", "mount"], 
        correct: ["pvcreate", "vgcreate", "lvcreate", "mkfs", "mount"], 
        rationale: "Physical Vol -> Vol Group -> Logical Vol -> Format (Filesystem) -> Mount." 
    },
    { 
        type: "SINGLE", 
        text: "You need to remove a PV that has data on it. What command must be run first?", 
        options: [
            {text: "pvmove", correct: true},
            {text: "vgreduce", correct: false},
            {text: "pvremove", correct: false}
        ], 
        rationale: "pvmove evacuates data to other disks in the VG. Only then can you reduce/remove." 
    },
    // --- HOTSPOT LVM (Colocado en Topic 14) ---
    { 
        type: "HOTSPOT", 
        text: "Identify the Striped Logical Volume (RAID 0) layout in the diagram.", 
        // --- AQU√ç VA TU IMAGEN DE LVM ---
        image: "assets/img/lvm_types_diagram.png", 
        target: {x: 50, y: 80}, 
        rationale: "Striped volumes distribute data evenly across multiple disks simultaneously to improve performance.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-lvm.html' target='_blank'>üìö SUSE Docs: LVM Striping</a>" 
    },

    // -------------------------------------------------------------------------
    // 15 Btrfs Management
    // -------------------------------------------------------------------------
    { 
        type: "MULTI", 
        text: "Which statements regarding subvolumes in a BtrFS filesystem are true? (Choose two)", 
        options: [
            {text: "Every subvolume must have the same quota.", correct: false},
            {text: "Subvolumes can be mounted separately using -o sub=...", correct: true},
            {text: "Every subvolume must begin with '@'.", correct: false},
            {text: "Multiple virtual filesystems can be created inside the BtrFS filesystem.", correct: true}
        ], 
        rationale: "BtrFS subvolumes act like independent file trees and can be mounted individually." 
    },

    // -------------------------------------------------------------------------
    // 16 Network Management Fundamentals
    // -------------------------------------------------------------------------
    { 
        type: "FILL", 
        text: "Which file contains the main configuration for the default NTP service (chrony) in SLES 15?", 
        validAnswers: ["/etc/chrony.conf"], 
        rationale: "SLES 15 uses Chrony by default, so the file is /etc/chrony.conf. (Legacy NTP used /etc/ntp.conf).<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-time.html' target='_blank'>üìö SUSE Docs: Time Sync</a>" 
    },
    { 
        type: "SINGLE", 
        text: "Which command shows the current routing table?", 
        options: [
            {text: "ipconfig -rd", correct: false},
            {text: "ip route show", correct: true},
            {text: "cat /etc/sysconfig/routes", correct: false},
            {text: "netstat -i", correct: false}
        ], 
        rationale: "'ip route show' (or 'ip r') is the standard command. 'ipconfig' is Windows. /etc/sysconfig/routes shows static routes, not the live table.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-network.html' target='_blank'>üìö SUSE Docs: Routing</a>" 
    },
    { 
        type: "SINGLE", 
        text: "What protocol is used by tools like 'ping' for network troubleshooting?", 
        options: [
            {text: "TCP", correct: false},
            {text: "ICMP", correct: true},
            {text: "UDP", correct: false}
        ], 
        rationale: "ICMP (Internet Control Message Protocol) is used for diagnostics." 
    },
    { 
        type: "FILL", 
        text: "Which file contains the configuration for DNS nameservers?", 
        validAnswers: ["/etc/resolv.conf"], 
        rationale: "/etc/resolv.conf is where you define the 'nameserver' IP addresses." 
    },

    // -------------------------------------------------------------------------
    // 17 Software Management
    // -------------------------------------------------------------------------
    { 
        type: "SINGLE", 
        text: "You have added a new directory to /etc/exports. Which command makes it available without restarting the service?", 
        options: [
            {text: "exportfs -r", correct: true},
            {text: "/usr/sbin/rpc.mountd -restart", correct: false},
            {text: "systemctl restart nfs", correct: false},
            {text: "mount -a", correct: false}
        ], 
        rationale: "'exportfs -r' (reexport) refreshes the list of exported directories from /etc/exports without disconnecting active clients.<br><br><a href='https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-nfs.html' target='_blank'>üìö SUSE Docs: Exporting NFS</a>" 
    },
    { 
        type: "SINGLE", 
        text: "What is required to access updates for SLE?", 
        options: [
            {text: "A Software Subscription", correct: false},
            {text: "Nothing", correct: false},
            {text: "Account Registration", correct: false},
            {text: "An account with SUSE Customer Center", correct: false},
            {text: "An account with SUSE Customer Center and a SLE Product Key", correct: true}
        ], 
        rationale: "To access repositories and updates, you need to register with SCC using a Product Key." 
    },
    { 
        type: "MULTI", 
        text: "What two commands will you use if you are going to compile and install from source code? (Choose two)", 
        options: [
            {text: "compile", correct: false},
            {text: "make install", correct: true},
            {text: "assemble", correct: false},
            {text: "./configure", correct: true},
            {text: "./compile", correct: false}
        ], 
        rationale: "The standard workflow is usually: ./configure, make, and make install." 
    },
    { 
        type: "SINGLE", 
        text: "What is the command to remove repository number 4?", 
        options: [
            {text: "yumrepo -del 4", correct: false},
            {text: "zypper rr 4", correct: true},
            {text: "rpm -e 4", correct: false},
            {text: "yast remove 4", correct: false}
        ], 
        rationale: "`zypper rr` stands for removerepo." 
    },
    { 
        type: "FILL", 
        text: "Which rpm flag displays a progress bar with hash marks (#) during installation?", 
        validAnswers: ["-h", "--hash"], 
        rationale: "-h (hash) prints hashes. -v is just verbose text." 
    },
    { 
        type: "SINGLE", 
        text: "In the package name 'bash-4.4-23.1.x86_64.rpm', which part is the Release?", 
        options: [
            {text: "4.4", correct: false},
            {text: "23.1", correct: true},
            {text: "x86_64", correct: false}
        ], 
        rationale: "Format is Name-Version-Release. Release (23.1) is the SUSE build number." 
    },

    // -------------------------------------------------------------------------
    // 18 System Logging
    // -------------------------------------------------------------------------
    { 
        type: "FILL", 
        text: "Enter the command used to generate a log message manually to the syslog system.", 
        validAnswers: ["logger"], 
        rationale: "The command is 'logger'. 'log' does not exist." 
    },
    { 
        type: "SINGLE", 
        text: "What mechanism triggers logrotate in SLES 15?", 
        options: [
            {text: "Cron daily script", correct: false},
            {text: "Systemd Timer", correct: true},
            {text: "Manual execution only", correct: false}
        ], 
        rationale: "SLES 15 uses a systemd timer (logrotate.timer) instead of a cron job." 
    },
    { 
        type: "SINGLE", 
        text: "What does the term 'action' mean when referring to system logging (rsyslog/syslog-ng)?", 
        options: [
            {text: "An action defines where a log message ends up (file, db, remote).", correct: true},
            {text: "An action defines the severity.", correct: false},
            {text: "An action is used to filter out messages.", correct: false},
            {text: "An action is a process facility.", correct: false}
        ], 
        rationale: "In logging config, the selector filters the message, and the action defines where to write it." 
    },
    { 
        type: "SINGLE", 
        text: "What is the name of the system logging facility in SUSE Linux Enterprise?", 
        options: [
            {text: "mail-log", correct: false},
            {text: "syslog", correct: false},
            {text: "syslog-ng", correct: false},
            {text: "rsyslog / syslog-ng", correct: true} 
        ], 
        rationale: "SLES uses rsyslog or syslog-ng (depending on version/config), but syslog-ng is the traditional robust answer for SLES." 
    }
];

// =============================================================================
//  ENGINE LOGIC
// =============================================================================
const quiz = {
    list: [],
    idx: 0,
    answers: {}, // Stores user answers by Question Index { 0: {correct: true, val: ...}, ... }
    
    start() {
        // Shuffle and Init
        this.list = [...DATA].sort(() => Math.random() - 0.5);
        this.idx = 0;
        this.answers = {};
        
        document.getElementById('total-q').innerText = this.list.length;
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');
        document.getElementById('footer').style.display = 'flex';
        this.load();
    },

    load() {
        const q = this.list[this.idx];
        const answered = this.answers[this.idx];
        
        // UI Updates
        document.getElementById('curr-q').innerText = this.idx + 1;
        document.getElementById('progress').style.width = ((this.idx / this.list.length) * 100) + '%';
        document.getElementById('q-type').innerText = q.type;
        document.getElementById('q-text').innerText = q.text;
        
        // Buttons State
        document.getElementById('btn-prev').disabled = (this.idx === 0);
        document.getElementById('btn-check').style.display = answered ? 'none' : 'block';
        document.getElementById('btn-next').style.display = answered ? 'block' : 'none';
        
        // Clear & Render
        const area = document.getElementById('render-area');
        area.innerHTML = '';
        document.getElementById('feedback').style.display = 'none';

        if(q.type === 'SINGLE' || q.type === 'MULTI') this.renderOptions(q, area, answered);
        else if(q.type === 'FILL') this.renderFill(q, area, answered);
        else if(q.type === 'ORDER') this.renderOrder(q, area, answered);
        else if(q.type === 'MATCHING') this.renderMatch(q, area, answered);
        else if(q.type === 'HOTSPOT') this.renderHotspot(q, area, answered);

        if(answered) this.showFeedback(answered.isCorrect, q.rationale);
    },

    renderOptions(q, container, prevAns) {
        const div = document.createElement('div'); div.className = 'opt-list';
        const isMulti = q.type === 'MULTI';
        
        q.options.forEach((opt, i) => {
            const btn = document.createElement('div');
            btn.className = 'opt-btn';
            if(prevAns) btn.classList.add('disabled');
            
            // Check logic for previous answer visual state
            let isChecked = false;
            if(prevAns && prevAns.userSel.includes(i)) isChecked = true;

            btn.innerHTML = `<input type="${isMulti?'checkbox':'radio'}" name="opt" ${isChecked?'checked':''} ${prevAns?'disabled':''}> ${opt.text}`;
            
            if(isChecked) btn.classList.add('selected');

            if(!prevAns) {
                btn.onclick = (e) => {
                    const inp = btn.querySelector('input');
                    if(e.target !== inp) {
                        if(isMulti) inp.checked = !inp.checked;
                        else { 
                            div.querySelectorAll('input').forEach(x => x.checked = false);
                            div.querySelectorAll('.opt-btn').forEach(x => x.classList.remove('selected'));
                            inp.checked = true; 
                        }
                    }
                    // Visual update
                    if(isMulti) btn.classList.toggle('selected', inp.checked);
                    else btn.classList.add('selected');
                };
            }
            div.appendChild(btn);
        });
        container.appendChild(div);
    },

    renderFill(q, container, prevAns) {
        const inp = document.createElement('input');
        inp.type = 'text'; inp.className = 'input-fill';
        inp.placeholder = 'Type your answer...';
        inp.autocomplete = 'off';
        if(prevAns) { inp.value = prevAns.userVal; inp.disabled = true; }
        container.appendChild(inp);
    },

    renderOrder(q, container, prevAns) {
        const wrap = document.createElement('div'); wrap.className = 'drag-container';
        
        // COLUMNA 1: Opciones
        const col1 = document.createElement('div'); col1.className = 'drag-col';
        col1.innerHTML = `<div class="drag-header">OPTIONS</div>`;
        const zoneSrc = document.createElement('div'); zoneSrc.className = 'drop-zone';
        zoneSrc.id = 'drag-src';

        // COLUMNA 2: Tu Respuesta
        const col2 = document.createElement('div'); col2.className = 'drag-col';
        col2.innerHTML = `<div class="drag-header">YOUR ANSWER</div>`;
        const zoneTgt = document.createElement('div'); zoneTgt.className = 'drop-zone';
        zoneTgt.id = 'drag-tgt';

        // L√ìGICA DEFENSIVA: Si prevAns.userOrder falla, usamos array vac√≠o []
        let srcItems = [], tgtItems = [];
        if(prevAns) {
            tgtItems = prevAns.userOrder || []; 
        } else {
            srcItems = [...(q.items || [])].sort(() => Math.random() - 0.5); 
        }

        const createItem = (txt) => {
            const el = document.createElement('div'); el.className = 'drag-item'; el.innerText = txt;
            if(!prevAns) {
                el.draggable = true;
                el.ondragstart = (e) => { e.dataTransfer.setData('text', txt); };
            } else {
                el.style.cursor = 'default'; el.style.opacity = '0.8';
            }
            return el;
        };

        srcItems.forEach(t => zoneSrc.appendChild(createItem(t)));
        tgtItems.forEach(t => zoneTgt.appendChild(createItem(t)));

        if(!prevAns) {
            [zoneSrc, zoneTgt].forEach(zone => {
                zone.ondragover = e => { e.preventDefault(); zone.classList.add('drag-over'); };
                zone.ondragleave = () => zone.classList.remove('drag-over');
                zone.ondrop = e => {
                    e.preventDefault(); zone.classList.remove('drag-over');
                    const txt = e.dataTransfer.getData('text');
                    const allItems = document.querySelectorAll('.drag-item');
                    let draggedEl;
                    allItems.forEach(el => { if(el.innerText === txt) draggedEl = el; });
                    if(draggedEl) zone.appendChild(draggedEl);
                };
            });
        }

        col1.appendChild(zoneSrc); col2.appendChild(zoneTgt);
        wrap.appendChild(col1); wrap.appendChild(col2);
        container.appendChild(wrap);
    },

    renderMatch(q, container, prevAns) {
        // MATCHING: 2 Columns. Left = Terms (Static), Right = Drops.
        // Pool of definitions at bottom.
        
        // If answered, we lock it.
        const grid = document.createElement('div');
        
        // Terms Rows
        const userMatches = prevAns ? prevAns.matches : {}; // {term: def}

        q.pairs.forEach(p => {
            const row = document.createElement('div'); row.className = 'match-row';
            
            // Term
            const term = document.createElement('div'); term.className = 'match-static'; term.innerText = p.term;
            
            // Slot
            const slot = document.createElement('div'); slot.className = 'match-drop drop-zone';
            slot.dataset.term = p.term;

            // If answered, fill slot
            if(prevAns && userMatches[p.term]) {
                const filled = document.createElement('div'); filled.className = 'drag-item'; 
                filled.innerText = userMatches[p.term]; filled.style.cursor='default';
                slot.appendChild(filled);
            }

            if(!prevAns) {
                slot.ondragover = e => { e.preventDefault(); slot.classList.add('drag-over'); };
                slot.ondragleave = () => slot.classList.remove('drag-over');
                slot.ondrop = (e) => {
                    e.preventDefault(); slot.classList.remove('drag-over');
                    const txt = e.dataTransfer.getData('text/plain');
                    if(slot.children.length === 0) {
                        const el = document.querySelector(`.pool-item[data-val="${txt}"]`);
                        if(el) slot.appendChild(el);
                    }
                };
            }

            row.appendChild(term); row.appendChild(slot);
            grid.appendChild(row);
        });
        container.appendChild(grid);

        // Pool
        if(!prevAns) {
            const pool = document.createElement('div'); 
            pool.style.marginTop = '20px'; pool.style.display = 'flex'; pool.style.gap='10px'; pool.style.flexWrap='wrap';
            pool.id = 'match-pool';
            pool.className = 'drop-zone';
            
            q.pairs.map(p => p.def).sort(() => Math.random() - 0.5).forEach(def => {
                const el = document.createElement('div'); el.className = 'drag-item pool-item';
                el.draggable = true; el.innerText = def; el.dataset.val = def;
                el.ondragstart = e => e.dataTransfer.setData('text/plain', def);
                pool.appendChild(el);
            });
            
            pool.ondragover = e => e.preventDefault();
            pool.ondrop = e => {
                e.preventDefault();
                const txt = e.dataTransfer.getData('text/plain');
                const el = document.querySelector(`.pool-item[data-val="${txt}"]`);
                if(el) pool.appendChild(el);
            }
            
            container.appendChild(pool);
        }
    },

    renderHotspot(q, container, prev) {
        const wrap = document.createElement('div'); wrap.style.textAlign = 'center';
        const area = document.createElement('div'); area.className = 'hotspot-container';
        
        const img = document.createElement('img'); img.src = q.image; img.className = 'hotspot-img';
        const pin = document.createElement('div'); pin.className = 'hotspot-pin'; pin.innerHTML = 'üìç';

        if (prev) {
            pin.classList.add('active');
            // Protecci√≥n: Si x/y no existen, usar 0
            pin.style.left = (prev.x || 0) + '%';
            pin.style.top = (prev.y || 0) + '%';
            if (!prev.isCorrect) pin.style.background = '#ef4444'; 
        } else {
            area.onclick = (e) => {
                const rect = area.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                pin.classList.add('active');
                pin.style.left = x + '%'; pin.style.top = y + '%';
                area.dataset.x = x; area.dataset.y = y;
            };
        }
        area.appendChild(img); area.appendChild(pin);
        wrap.appendChild(area); container.appendChild(wrap);
    },

    getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.drag-item:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
            else return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    },

    check() {
        const q = this.list[this.idx];
        let isCorrect = false;
        let dataToSave = {};

        if(q.type === 'SINGLE') {
            const opts = document.querySelectorAll('.opt-btn');
            let s = -1;
            opts.forEach((o, i) => { if(o.querySelector('input').checked) s = i; });
            if(s > -1 && q.options[s].correct) isCorrect = true;
            dataToSave = { userSel: [s] };
        } 
        else if(q.type === 'MULTI') {
            const opts = document.querySelectorAll('.opt-btn');
            let userSel = []; let allGood = true;
            opts.forEach((o, i) => {
                const checked = o.querySelector('input').checked;
                if(checked) userSel.push(i);
                if(checked !== q.options[i].correct) allGood = false;
            });
            if(userSel.length > 0 && allGood) isCorrect = true;
            dataToSave = { userSel };
        }
        else if(q.type === 'FILL') {
            const val = document.querySelector('.input-fill').value.trim();
            if(q.validAnswers.some(ans => ans.toLowerCase() === val.toLowerCase())) isCorrect = true;
            dataToSave = { userVal: val };
        }
        else if(q.type === 'ORDER') {
            const el = document.getElementById('drag-tgt');
            const current = el ? [...el.children].map(c => c.innerText) : [];
            if(JSON.stringify(current) === JSON.stringify(q.correct)) isCorrect = true;
            dataToSave = { userOrder: current }; // IMPORTANTE: userOrder coincide con renderOrder
        }
        else if(q.type === 'MATCHING') {
            const slots = document.querySelectorAll('.match-drop');
            let hits = 0; let m = {};
            slots.forEach(s => {
                if(s.children.length > 0) {
                    const txt = s.children[0].innerText;
                    m[s.dataset.term] = txt;
                    const pair = q.pairs.find(p => p.term === s.dataset.term);
                    if(pair && pair.def === txt) hits++;
                }
            });
            if(hits === q.pairs.length) isCorrect = true;
            dataToSave = { matches: m };
        }
        else if(q.type === 'HOTSPOT') {
            const area = document.querySelector('.hotspot-container');
            // Protecci√≥n contra null
            if(area) {
                const userX = parseFloat(area.dataset.x || -999);
                const userY = parseFloat(area.dataset.y || -999);
                const diffX = Math.abs(userX - q.target.x);
                const diffY = Math.abs(userY - q.target.y);
                if(diffX < 10 && diffY < 10) isCorrect = true;
                dataToSave = { x: userX, y: userY };
            }
        }

        this.answers[this.idx] = { isCorrect, ...dataToSave };
        this.showFeedback(isCorrect, q.rationale);
        this.load();
    },

    showFeedback(isCorrect, text) {
        const fb = document.getElementById('feedback');
        fb.style.display = 'block';
        fb.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;
        fb.innerHTML = `<strong>${isCorrect ? 'Correct!' : 'Incorrect.'}</strong> ${text}`;
        
        // Ensure buttons toggle
        document.getElementById('btn-check').style.display = 'none';
        document.getElementById('btn-next').style.display = 'block';
    },

    next() {
        if(this.idx < this.list.length - 1) {
            this.idx++;
            this.load();
        } else {
            this.finish();
        }
    },

    prev() {
        if(this.idx > 0) {
            this.idx--;
            this.load();
        }
    },

    finish() {
        document.getElementById('quiz-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
        document.getElementById('footer').style.display = 'none';

        const total = this.list.length;
        const correct = Object.values(this.answers).filter(a => a.isCorrect).length;
        const pct = Math.round((correct / total) * 100);

        document.getElementById('final-score').innerText = pct + '%';
        document.getElementById('final-msg').innerText = pct >= 70 ? "PASSED! Great job." : "Failed. Keep practicing.";
        document.getElementById('final-score').style.color = pct >= 70 ? 'var(--secondary)' : 'var(--wrong)';
        document.getElementById('final-score').style.borderColor = pct >= 70 ? 'var(--secondary)' : 'var(--wrong)';
    }
};
</script>
</body>
</html>